class DictionaryPanel{constructor(){this.wordListEl=document.getElementById("wordList"),this.searchInputEl=document.getElementById("searchInput"),this.addWordBtnEl=document.getElementById("addWordBtn"),this.newWordKanjiEl=document.getElementById("newWordKanji"),this.newWordReadingEl=document.getElementById("newWordReading"),this.wordCountEl=document.getElementById("wordCount"),this.words=[],this.filter="",this.init()}async init(){this.bindEvents(),await this.loadDictionary()}bindEvents(){this.searchInputEl.addEventListener("input",t=>{this.filter=t.target.value.toLowerCase(),this.renderWordList()}),this.addWordBtnEl.addEventListener("click",()=>this.addWord())}async loadDictionary(){try{const t=await chrome.runtime.sendMessage({type:"SEARCH_DICTIONARY",query:"",limit:5e3});t&&t.success?(this.words=t.results.sort((t,e)=>t.kanji.localeCompare(e.kanji,"ja")),this.renderWordList()):(console.error("Failed to load dictionary:",t?.error),this.wordListEl.innerHTML='<div class="word-item">辞書の読み込みに失敗しました。</div>')}catch(t){console.error("Error loading dictionary:",t),this.wordListEl.innerHTML='<div class="word-item">辞書の読み込み中にエラーが発生しました。</div>'}}renderWordList(){this.wordListEl.innerHTML="";const t=this.words.filter(t=>t.kanji.toLowerCase().includes(this.filter)||t.reading.toLowerCase().includes(this.filter)||t.romaji.toLowerCase().includes(this.filter));0===t.length&&(this.wordListEl.innerHTML='<div class="word-item">該当する単語はありません。</div>');for(const e of t){const t=document.createElement("div");t.className="word-item",t.innerHTML=`\n            <div class="word-display">\n                <span class="word-kanji">${e.kanji}</span>\n                <span class="word-reading">${e.reading} (${e.romaji})</span>\n            </div>\n            <button class="delete-btn" data-kanji="${e.kanji}">削除</button>\n        `,this.wordListEl.appendChild(t)}this.wordCountEl.textContent=this.words.length,this.wordListEl.querySelectorAll(".delete-btn").forEach(t=>{t.addEventListener("click",t=>this.deleteWord(t.target.dataset.kanji))})}async addWord(){const t=this.newWordKanjiEl.value.trim(),e=this.newWordReadingEl.value.trim();if(t&&e)try{const i=await chrome.runtime.sendMessage({type:"ADD_TO_DICTIONARY",kanji:t,reading:e});i&&i.success?(await this.loadDictionary(),this.newWordKanjiEl.value="",this.newWordReadingEl.value=""):alert("単語の追加に失敗しました: "+i?.error)}catch(t){console.error("Error adding word:",t),alert("単語の追加中にエラーが発生しました。")}else alert("単語とよみを両方入力してください。")}async deleteWord(t){if(confirm(`「${t}」を辞書から削除しますか？`))try{const e=await chrome.runtime.sendMessage({type:"REMOVE_FROM_DICTIONARY",kanji:t});e&&e.success?await this.loadDictionary():alert("単語の削除に失敗しました: "+e?.error)}catch(t){console.error("Error deleting word:",t),alert("単語の削除中にエラーが発生しました。")}}}document.addEventListener("DOMContentLoaded",()=>{new DictionaryPanel});